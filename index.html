<html>
<head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://code.highcharts.com/stock/highstock.js"></script>
<script src="https://code.highcharts.com/stock/modules/exporting.js"></script>
<script>
var scale = 'linear';
var limit = 25;
var currency = 'BTC';
var baseCurrency = 'USD';
var zoom = '1m';
var chart;

$(function() {
	chart = Highcharts.stockChart('chart', {
		chart: {
			height: '56%',
			events: {
				load:  function() {
					chart = this,
					requestData('1m');
				}
			}
		},
		
		rangeSelector: {
			enabled: false
		},
		
		scrollbar: {
			enabled: false
		},
		
		navigator: {
			enabled: false
		},
		
		title: {
			align: 'left',
			style: {
				fontWeight: 'bold'
			}
		},
		
		yAxis: [{
			title: {
				text: 'OHLC'
			},
			resize: {
				enabled: true
			},
		},
		{
			visible: false
		}],
		
		plotOptions: {
			series: {
				softThreshold: true
			},
			candlestick: {
				color: '#d82e2e',
				lineColor: '#d82e2e',	    		
				upLineColor: '#4dd82d',
				upColor: '#4dd82d'
			}
		},
		
		tooltip: {
			backgroundColor: {
				linearGradient: {
					x1: 0,
					y1: 0,
					x2: 0,
					y2: 1
				},
				stops: [
					[0, 'white'],
					[1, '#EEE']
				]
			},
			borderColor: 'gray',
			borderWidth: 1,
			shared: true,
			follorPointer: true,
			formatter: function () {
				var s;
				s = Highcharts.dateFormat('%Y-%m-%d %H:%M:%S', new Date(this.x)) + "<br/>";
				s += "<span style='font-size:3px;color:transparent;opacity:0'>paragraph</span><br/>";
				s += "<b>Open:</b> " + this.points[1].point.open.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 8}) + "<br/>";
				s += "<b>High:</b> " + this.points[1].point.high.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 8}) + "<br/>";
				s += "<b>Low:</b> " + this.points[1].point.low.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 8}) + "<br/>";
				s += "<b>Close:</b> " + this.points[1].point.close.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 8}) + "<br/>";
				s += "<span style='font-size:3px;color:transparent;opacity:0'>paragraph</span><br/>";
				s += "<b>Volume:</b> " + this.points[0].y.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 8}) + "<br/>";
				return s;
			}
		},
		
		series: [{
			type: 'column',
			name: 'Volume',
			yAxis: 1,
			dataGrouping: {
				enabled: false
			}
		},
		{
			type: 'candlestick',
			name: 'OHLC',
			yAxis: 0,
			dataGrouping: {
				enabled: false
			}
		}],
		
		exporting: {
			enabled: false
		},
		
		credits: {
			enabled: false
		}
	});
});

function requestData(z) {
	zoom = z;
	var url;
	if(z == '1m') { url = 'https://min-api.cryptocompare.com/data/histominute?fsym=' + currency + '&tsym=' + baseCurrency + '&limit=' + (limit - 1) + '&aggregate=1'; }
	if(z == '5m') { url = 'https://min-api.cryptocompare.com/data/histominute?fsym=' + currency + '&tsym=' + baseCurrency + '&limit=' + (limit - 1) + '&aggregate=5'; }
	if(z == '10m') { url = 'https://min-api.cryptocompare.com/data/histominute?fsym=' + currency + '&tsym=' + baseCurrency + '&limit=' + (limit - 1) + '&aggregate=10'; }
	if(z == '1h') { url = 'https://min-api.cryptocompare.com/data/histohour?fsym=' + currency + '&tsym=' + baseCurrency + '&limit=' + (limit - 1) + '&aggregate=1'; }
	if(z == '5h') { url = 'https://min-api.cryptocompare.com/data/histohour?fsym=' + currency + '&tsym=' + baseCurrency + '&limit=' + (limit - 1) + '&aggregate=5'; }
	if(z == '10h') { url = 'https://min-api.cryptocompare.com/data/histohour?fsym=' + currency + '&tsym=' + baseCurrency + '&limit=' + (limit - 1) + '&aggregate=10'; }
	if(z == '1d') { url = 'https://min-api.cryptocompare.com/data/histoday?fsym=' + currency + '&tsym=' + baseCurrency + '&limit=' + (limit - 1) + '&aggregate=1'; }
	if(z == '3d') { url = 'https://min-api.cryptocompare.com/data/histoday?fsym=' + currency + '&tsym=' + baseCurrency + '&limit=' + (limit - 1) + '&aggregate=3'; }
	if(z == '1w') { url = 'https://min-api.cryptocompare.com/data/histoday?fsym=' + currency + '&tsym=' + baseCurrency + '&limit=' + (limit - 1) + '&aggregate=7'; }
	$.getJSON(url, function(data) {
		data = data['Data'];
		// split the data set into ohlc and volume
		var ohlc = [],
			volume = [],
			dataLength = data.length;
		
		for (i = 0; i < dataLength; i++) {
			if(data[i]['low'] > 0) {
				ohlc.push([
					data[i]['time'] * 1000, // timestamp in milliseconds
					data[i]['open'], // open
					data[i]['high'], // high
					data[i]['low'], // low
					data[i]['close'] // close
				]);
				
				volume.push([
					data[i]['time'] * 1000, // timestamp in milliseconds
					data[i]['volumeto'] // volume
				]);
			}
		}
		chart.yAxis[0].update({type: scale});
		chart.xAxis[0].setExtremes();
		chart.setTitle({text: currency + '/' + baseCurrency});
		chart.series[1].setData(ohlc, false);
		chart.series[0].setData(volume, false);
		chart.redraw();
	});
}

function changeScale(s) {
	scale = s;
	requestData(zoom);
}

function changeZoom(z) {
	zoom = z;
	requestData(zoom);
}

function changeLimit(l) {
	limit = l;
	requestData(zoom);
}

function changeCurrency(c) {
	currency = c;
	requestData(zoom);
}

function changeBaseCurrency(c) {
	baseCurrency = c;
	requestData(zoom);
}
</script>
<style>
.chart {
	width: 85%;
	margin: auto;
}
</style>
</head>
<body>

<div id="container">
	Scale: 
	<a href="#" onclick="changeScale('linear');">linear</a>
	<a href="#" onclick="changeScale('logarithmic');">logarithmic</a>
	<br/>
	Zoom: 
	<a href="#" onclick="changeZoom('1m');">1m</a>
	<a href="#" onclick="changeZoom('5m');">5m</a>
	<a href="#" onclick="changeZoom('10m');">10m</a>
	<a href="#" onclick="changeZoom('1h');">1h</a>
	<a href="#" onclick="changeZoom('5h');">5h</a>
	<a href="#" onclick="changeZoom('10h');">10h</a>
	<a href="#" onclick="changeZoom('1d');">1d</a>
	<a href="#" onclick="changeZoom('3d');">3d</a>
	<a href="#" onclick="changeZoom('1w');">1w</a>
	<br/>
	Limit: 
	<a href="#" onclick="changeLimit('10');">10</a>
	<a href="#" onclick="changeLimit('25');">25</a>
	<a href="#" onclick="changeLimit('50');">50</a>
	<a href="#" onclick="changeLimit('100');">100</a>
	<a href="#" onclick="changeLimit('200');">200</a>
	<br/>
	Currency: 
	<a href="#" onclick="changeCurrency('BTC');">BTC</a>
	<a href="#" onclick="changeCurrency('BCH');">BCH</a>
	<a href="#" onclick="changeCurrency('ETH');">ETH</a>
	<a href="#" onclick="changeCurrency('LTC');">LTC</a>
	<a href="#" onclick="changeCurrency('XMR');">XMR</a>
	<a href="#" onclick="changeCurrency('NMC');">NMC</a>
	<a href="#" onclick="changeCurrency('AEON');">AEON</a>
	<br />
	Base Currency: 
	<a href="#" onclick="changeBaseCurrency('BTC');">BTC</a>
	<a href="#" onclick="changeBaseCurrency('USD');">USD</a>
	<a href="#" onclick="changeBaseCurrency('EUR');">EUR</a>
	<div id="chart" class="chart"></div>
</div>

</body>
</html>
